{"code":"import fs from 'fs';\r\nimport chalk from 'chalk';\r\nimport SftpClient from 'ssh2-sftp-client';\r\nconst sftp = new SftpClient();\r\nconst vitePluginSftp = ({ path, remotePath, oldRemotePath, ...data }) => {\r\n    return {\r\n        name: 'vite-plugin-sftp',\r\n        enforce: 'post',\r\n        async closeBundle() {\r\n            console.log('üöÄdeploy start');\r\n            const isExist = await fs.existsSync(path);\r\n            if (!isExist) {\r\n                console.error(chalk.red(`deploy failure: ${path} not exist ‚ùå`));\r\n                return;\r\n            }\r\n            try {\r\n                await sftp.connect(data);\r\n                if (oldRemotePath) {\r\n                    if (await sftp.exists(`${remotePath}`)) {\r\n                        console.log(chalk.blue(`deploy remove ${oldRemotePath}`));\r\n                        await sftp.rmdir(`${oldRemotePath}`, true);\r\n                    }\r\n                    if (await sftp.exists(remotePath)) {\r\n                        console.log(chalk.blue(`deploy rename ${remotePath} to ${oldRemotePath}`));\r\n                        await sftp.rename(remotePath, `${oldRemotePath}`);\r\n                    }\r\n                }\r\n                console.log(chalk.blue(`deploy uploadDir ${path} to ${remotePath}`));\r\n                await sftp.uploadDir(path, remotePath);\r\n                await sftp.end();\r\n                console.log(chalk.green('deploy success‚úÖ'));\r\n            }\r\n            catch (err) {\r\n                console.error(chalk.red(`deploy failure: ${err}‚ùå`));\r\n                if (oldRemotePath) {\r\n                    console.log(chalk.red(`deploy rename ${oldRemotePath} to  ${remotePath}`));\r\n                    await sftp.rename(`${oldRemotePath}`, remotePath);\r\n                }\r\n                sftp.end();\r\n            }\r\n        },\r\n    };\r\n};\r\nexport default vitePluginSftp;\r\n","references":["/Users/huangbo/Desktop/myself/vite-plugin-sftp/node_modules/vite/dist/node/index.d.ts","/Users/huangbo/Desktop/myself/vite-plugin-sftp/node_modules/chalk/source/index.d.ts","/Users/huangbo/Desktop/myself/vite-plugin-sftp/node_modules/@types/ssh2-sftp-client/index.d.ts"]}
